@using DailyLoan.Library.Status
<div class="card-body bg-light p-3 rounded ">
    <div class="input-group mb-3 input-group-sm">
        <input type="text" class="form-control" placeholder="ชื่อ">
        <input type="text" class="form-control" placeholder="นามสกุล">
        <button type="button" class="btn btn-info btn-sm">
            <i class="fa fa-search"></i>
            ค้นหา
        </button>
        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#adduser">
            <i class="fa fa-plus-circle"></i>
            เพิ่มผู้ใช้งาน
        </button>
        <!-- The Modal -->
        <div class="modal" id="adduser">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header" style="background-color:#ff9800;color:#000;">
                        <h4 class="modal-title">เพิ่มข้อมูลผู้ใช้งาน</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <!-- Modal body -->
                    <div class="modal-body">
                        <form>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <input type="radio" id="addstatus1" name="addstatus" value="1">
                                            <label for="addstatus1">ใช้งาน</label>
                                            <input type="radio" id="addstatus2" name="addstatus" value="2">
                                            <label for="addstatus2">ไม่ใช้งาน</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="addfirstname">ชื่อ</label>
                                            <input type="text" class="form-control form-control-sm" id="addfirstname" placeholder="ชื่อ">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="addlastname">นามสกุล</label>
                                            <input type="text" class="form-control form-control-sm" id="addlastname" placeholder="นามสกุล">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="addusername">ชื่อผู้ใช้งาน</label>
                                            <input type="text" class="form-control form-control-sm" id="addusername" placeholder="ชื่อผู้ใช้งาน">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="addnickname">ชื่อเล่น</label>
                                            <input type="text" class="form-control form-control-sm" id="addnickname" placeholder="ชื่อเล่น">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="addpassword">รหัสผ่าน</label>
                                            <input type="password" class="form-control form-control-sm" id="addpassword" placeholder="รหัสผ่าน">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="addconfirmpassword">ยืนยันรหัสผ่าน</label>
                                            <input type="password" class="form-control form-control-sm" id="addconfirmpassword" placeholder="ยืนยันรหัสผ่าน">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
                            {
                                <div class="form-row">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-md-6 pb-3">
                                                <label for="addhouse" class="form-label">บ้าน</label>
                                                <select class="form-select form-select-sm" id="addhouse" name="addhouse">
                                                    @foreach (var item in ViewBag.House)
                                                    {
                                                        <option value="@item.Id">@item.HouseName</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-md-6 pb-3">
                                                <label for="addcustomerline" class="form-label">สาย</label>
                                                <select class="form-select form-select-sm" id="addcustomerline" name="addcustomerline">
                                                    <option value="0">-</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 pb-3">
                                                <label for="adduseraccess" class="form-label">สิทธิ์ผู้ใช้งาน</label>
                                                <select class="form-select form-select-sm" id="adduseraccess" name="adduseraccess">
                                                    <option value="1">ผู้ดูแลระบบ</option>
                                                    <option value="2">เสมียน</option>
                                                    <option value="3">ผู้ตรวจสอบ</option>
                                                    <option value="4">คนเก็บ</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            }
                            else
                            {
                                <div class="form-row">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-md-6 pb-3">
                                                <label for="addcustomerline" class="form-label">สาย</label>
                                                <select class="form-select form-select-sm" id="addcustomerline" name="addcustomerline">
                                                    <option value="0">-</option>
                                                    @if (ViewBag.CustomerLine.Count() > 0)
                                                    {
                                                        @foreach (var item in ViewBag.CustomerLine)
                                                        {
                                                            <option value="@item.Id">@item.CustomerLineName</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 pb-3">
                                                <label for="adduseraccess" class="form-label">สิทธิ์ผู้ใช้งาน</label>
                                                <select class="form-select form-select-sm" id="adduseraccess" name="adduseraccess">
                                                    <option value="2">เสมียน</option>
                                                    <option value="3">ผู้ตรวจสอบ</option>
                                                    <option value="4">คนเก็บ</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="addphone1">เบอร์โทร 1</label>
                                            <input type="text" class="form-control form-control-sm" id="addphone1" placeholder="เบอร์โทร 1">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="addphone2">เบอร์โทร 2</label>
                                            <input type="text" class="form-control form-control-sm" id="addphone2" placeholder="เบอร์โทร 2">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" onclick="saveadd();" data-bs-dismiss="modal">บันทึก</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
                    </div>

                </div>
            </div>
        </div>
        <!-- The Modal viewuser -->
        <div class="modal" id="viewuser">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header" style="background-color:#ff9800;color:#000;">
                        <h4 class="modal-title">ข้อมูลผู้ใช้งาน</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <!-- Modal body -->
                    <div class="modal-body">
                        <form>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <input type="radio" id="viewstatus1" name="viewstatus" value="1" disabled>
                                            <label for="viewstatus1">ใช้งาน</label>
                                            <input type="radio" id="viewstatus2" name="viewstatus" value="2" disabled>
                                            <label for="viewstatus2">ไม่ใช้งาน</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="viewfirstname">ชื่อ</label>
                                            <input type="text" class="form-control form-control-sm" id="viewfirstname" placeholder="ชื่อ" readonly>
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="viewlastname">นามสกุล</label>
                                            <input type="text" class="form-control form-control-sm" id="viewlastname" placeholder="นามสกุล" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="viewusername">ชื่อผู้ใช้งาน</label>
                                            <input type="text" class="form-control form-control-sm" id="viewusername" placeholder="ชื่อผู้ใช้งาน" readonly>
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="viewnickname">ชื่อเล่น</label>
                                            <input type="text" class="form-control form-control-sm" id="viewnickname" placeholder="ชื่อเล่น" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
                            {
                                <div class="form-row">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-md-6 pb-3">
                                                <label for="viewhouse">บ้าน</label>
                                                <input type="text" class="form-control form-control-sm" id="viewhouse" placeholder="" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            }
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="viewuseraccess">สิทธิ์ผู้ใช้งาน</label>
                                            <input type="text" class="form-control form-control-sm" id="viewuseraccess" placeholder="" readonly>
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="viewcustomerline">สาย</label>
                                            <input type="text" class="form-control form-control-sm" id="viewcustomerline" placeholder="" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="viewphone1">เบอร์โทร 1</label>
                                            <input type="text" class="form-control form-control-sm" id="viewphone1" placeholder="เบอร์โทร 1" readonly>
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="viewphone2">เบอร์โทร 2</label>
                                            <input type="text" class="form-control form-control-sm" id="viewphone2" placeholder="เบอร์โทร 2" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
                    </div>

                </div>
            </div>
        </div>
        <!-- The Modal edituser -->
        <div class="modal" id="edituser">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header" style="background-color:#ff9800;color:#000;">
                        <h4 class="modal-title">แก้ไขข้อมูลผู้ใช้งาน</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <!-- Modal body -->
                    <div class="modal-body">
                        <form>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <input type="radio" id="status1" name="status" value="1">
                                            <label for="status1">ใช้งาน</label>
                                            <input type="radio" id="status2" name="status" value="2">
                                            <label for="status2">ไม่ใช้งาน</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="firstname">ชื่อ</label>
                                            <input type="text" class="form-control form-control-sm" id="firstname" placeholder="ชื่อ">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="lastname">นามสกุล</label>
                                            <input type="text" class="form-control form-control-sm" id="lastname" placeholder="นามสกุล">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="username">ชื่อผู้ใช้งาน</label>
                                            <input type="text" class="form-control form-control-sm" id="username" placeholder="ชื่อผู้ใช้งาน">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="nickname">ชื่อเล่น</label>
                                            <input type="text" class="form-control form-control-sm" id="nickname" placeholder="ชื่อเล่น">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="password">รหัสผ่าน</label>
                                            <input type="password" class="form-control form-control-sm" id="password" placeholder="รหัสผ่าน">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="confirmpassword">ยืนยันรหัสผ่าน</label>
                                            <input type="password" class="form-control form-control-sm" id="confirmpassword" placeholder="ยืนยันรหัสผ่าน">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
                            {
                                <div class="form-row">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-md-6 pb-3">
                                                <label for="house" class="form-label">บ้าน</label>
                                                <select class="form-select form-select-sm" id="house" name="house">
                                                    @foreach (var item in ViewBag.House)
                                                    {
                                                        <option value="@item.Id">@item.HouseName</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-md-6 pb-3">
                                                <label for="customerline" class="form-label">สาย</label>
                                                <select class="form-select form-select-sm" id="customerline" name="customerline">
                                                    <option value="0">-</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 pb-3">
                                                <label for="useraccess" class="form-label">สิทธิ์ผู้ใช้งาน</label>
                                                <select class="form-select form-select-sm" id="useraccess" name="useraccess">
                                                    <option value="1">ผู้ดูแลระบบ</option>
                                                    <option value="2">เสมียน</option>
                                                    <option value="3">ผู้ตรวจสอบ</option>
                                                    <option value="4">คนเก็บ</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            }
                            else
                            {

                                <input type="hidden" id="house" name="house" />
                                <div class="form-row">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-md-6 pb-3">
                                                <label for="customerline" class="form-label">สาย</label>
                                                <select class="form-select form-select-sm" id="customerline" name="customerline">
                                                    <option value="0">-</option>
                                                    @if (ViewBag.CustomerLine.Count() > 0)
                                                    {
                                                        @foreach (var item in ViewBag.CustomerLine)
                                                        {
                                                            <option value="@item.Id">@item.CustomerLineName</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 pb-3">
                                                <label for="useraccess" class="form-label">สิทธิ์ผู้ใช้งาน</label>
                                                <select class="form-select form-select-sm" id="useraccess" name="useraccess">
                                                    <option value="2">เสมียน</option>
                                                    <option value="3">ผู้ตรวจสอบ</option>
                                                    <option value="4">คนเก็บ</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            <div class="form-row">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6 pb-3">
                                            <label for="phone1">เบอร์โทร 1</label>
                                            <input type="text" class="form-control form-control-sm" id="phone1" placeholder="เบอร์โทร 1">
                                        </div>
                                        <div class="col-md-6 pb-3">
                                            <label for="phone2">เบอร์โทร 2</label>
                                            <input type="text" class="form-control form-control-sm" id="phone2" placeholder="เบอร์โทร 2">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <input type="hidden" id="editid" />
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" onclick="save();" data-bs-dismiss="modal">บันทึก</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
                    </div>

                </div>
            </div>
        </div>
        <!--end -->
    </div>
</div>
<table id="table" class="table table-hover" style="text-align: center; vertical-align: middle;">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">ชื่อผู้ใช้งาน</th>
            <th scope="col">ชื่อ</th>
            <th scope="col">นามสกุล</th>
            <th scope="col">สิทธิ์ผู้ใช้งาน</th>
            @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
            {
                <th scope="col">บ้าน</th>
            }
            @if (int.Parse(ViewBag.UserAccess) <= StatusUserAccess.UserAccess_Admin)
            {
                <th scope="col">สาย</th>
            }
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        @if (ViewBag.PageData.Count > 0)
        {
            foreach (var items in ViewBag.PageData)
            {
                <tr class='clickable-row'>
                    <th scope="row">@items.Id</th>
                    <td>@items.Username</td>
                    <td>@items.Firstname</td>
                    <td>@items.Lastname</td>
                    <td>@items.AccessText</td>
                    @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
                    {
                        <td>@items.HouseText</td>
                    }
                    @if (int.Parse(ViewBag.UserAccess) <= StatusUserAccess.UserAccess_Admin)
                    {
                        <td>@items.CustomerLineText</td>
                    }
                    <td>
                        <button type="button" class="btn btn-primary btn-sm btn-view" data-bs-toggle="modal" data-bs-target="#viewuser">
                            <i class="fa fa-eye"></i>
                            ดู
                        </button>
                        <button type="button" class="btn btn-warning btn-sm btn-edit" data-bs-toggle="modal" data-bs-target="#edituser">
                            <i class="fa fa-pen-square"></i>
                            แก้ไข
                        </button>
                        <button type="button" class="btn btn-danger btn-sm btn-delete" data-bs-toggle="modal" data-bs-target="#deluser">
                            <i class="fa fa-trash-alt"></i>
                            ลบ
                        </button>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>
<!-- The Modal deleteuser -->
<div class="modal" id="deluser">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header" style="background-color:red;color:#fff;">
                <h4 class="modal-title">ลบข้อมูล</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <form>
                    <h5>คุณต้องการลบข้อมูลผู้ใช้งาน <span id="deletename"></span> ใช่หรือไม่?</h5>
                </form>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" id="delete" class="btn btn-danger" data-bs-dismiss="modal">ลบ</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
            </div>
            <input type="hidden" id="deleteid" />
        </div>
    </div>
</div>
<!--end -->
<nav aria-label="Page navigation">
    <ul class="pagination ">
        <li class="page-item"><a class="page-link" href="#">ก่อนหน้า</a></li>
        <li class="page-item active"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item"><a class="page-link" href="#">ถัดไป</a></li>
    </ul>
</nav>

<script type="text/javascript">
    var root = '@Url.Content("~/")';
    var useraccess = '@ViewBag.UserAccess';
    var superadmin = '@StatusUserAccess.UserAccess_Superadmin';
    var admin = '@StatusUserAccess.UserAccess_Admin';
    root = (root == '/' ? "" : root);
    function save() {
        let req = new XMLHttpRequest();
        let formData = new FormData();

        formData.append("isNew", false);
        formData.append("HouseId", $("#house").val());
        formData.append("Status", $('input[name="status"]:checked').val() != undefined ? $('input[name="status"]:checked').val() : '');
        formData.append("UserAccess", $('#useraccess').val());
        formData.append("Id", $("#editid").val());
        formData.append("CustomerLineId", $("#customerline").val());
        formData.append("Username", $("#username").val());
        formData.append("Password", $("#password").val());
        formData.append("Confirmpassword", $("#confirmpassword").val());
        formData.append("Firstname", $("#firstname").val());
        formData.append("Lastname", $("#lastname").val());
        formData.append("Nickname", $("#nickname").val());
        formData.append("Phone1", $("#phone1").val());
        formData.append("Phone2", $("#phone2").val());
        req.open("POST", '/EditUser');
        req.send(formData);
        req.onload = function () {
            if (req.readyState != 4 || req.status != 200) {
                $("#msg").text(req.responseText)
            } else {
                alert(req.responseText);
                location.reload();
            }
        }
    }
    function saveadd() {
        let req = new XMLHttpRequest();
        let formData = new FormData();

        formData.append("isNew", true);
        formData.append("HouseId", 0);
        formData.append("Status", $('input[name="addstatus"]:checked').val() != undefined ? $('input[name="addstatus"]:checked').val() : '');
        formData.append("UserAccess", $('#adduseraccess').val());
        formData.append("Id", 0);
        formData.append("CustomerLineId", $("#addcustomerline").val());
        formData.append("Username", $("#addusername").val());
        formData.append("Password", $("#addpassword").val());
        formData.append("Confirmpassword", $("#addconfirmpassword").val());
        formData.append("Firstname", $("#addfirstname").val());
        formData.append("Lastname", $("#addlastname").val());
        formData.append("Nickname", $("#addnickname").val());
        formData.append("Phone1", $("#addphone1").val());
        formData.append("Phone2", $("#addphone2").val());
        req.open("POST", '/EditUser');
        req.send(formData);
        req.onload = function () {
            if (req.readyState != 4 || req.status != 200) {
                $("#msg").text(req.responseText)
            } else {
                alert(req.responseText);
                location.reload();
            }
        }
    }
    $(document).ready(function () {
        /** /
        $('#table').DataTable({
            "info": true,
            "pageLength": 10,
            "bLengthChange": false,
            "initComplete": function() {

            }
        });
        /**/
        if (useraccess == superadmin) {
            $('#house').on('change', function () {
                $('<option value="0">-</option>').appendTo($('#customerline').empty());
                $.ajax({
                    type: "GET",
                    url: root + "/GetCustomerLineAll/" + $("#house").val(),
                    contentType: "application/json; charset=utf-8;",
                    dataType: "json",
                    success: function (data) {
                        if (data != undefined) {
                            for (var it of data) {
                                $('#customerline').append('<option value="' + it['id'] + '">' + it['customerLineName'] + '</option>');
                            }
                        }
                    },
                    error: function (e) { console.log(e) }
                });
            });
            if ($('#house').val() != 0 && $('#house').val() != 1) {
                $('#customerline').empty();
                $.ajax({
                    type: "GET",
                    url: root + "/GetCustomerLineAll/" + $("#house").val(),
                    contentType: "application/json; charset=utf-8;",
                    dataType: "json",
                    success: function (data1) {
                        if (data1 != undefined) {
                            for (var it of data1) {
                                $('#customerline').append('<option value="' + it['id'] + '">' + it['customerLineName'] + '</option>');
                            }
                        }
                    },
                    error: function (e) { console.log(e) }
                });
            }
            $('#addhouse').on('change', function () {
                $('<option value="0">-</option>').appendTo($('#addcustomerline').empty());
                $.ajax({
                    type: "GET",
                    url: root + "/GetCustomerLineAll/" + $("#addhouse").val(),
                    contentType: "application/json; charset=utf-8;",
                    dataType: "json",
                    success: function (data) {
                        if (data != undefined) {
                            for (var it of data) {
                                $('#addcustomerline').append('<option value="' + it['id'] + '">' + it['customerLineName'] + '</option>');
                            }
                        }
                    },
                    error: function (e) { console.log(e) }
                });
            });
            if ($('#addhouse').val() != 0 && $('#addhouse').val() != 1) {
                $('#addcustomerline').empty();
                $.ajax({
                    type: "GET",
                    url: root + "/GetCustomerLineAll/" + $("#addhouse").val(),
                    contentType: "application/json; charset=utf-8;",
                    dataType: "json",
                    success: function (data1) {
                        if (data1 != undefined) {
                            for (var it of data1) {
                                $('#addcustomerline').append('<option value="' + it['id'] + '">' + it['customerLineName'] + '</option>');
                            }
                        }
                    },
                    error: function (e) { console.log(e) }
                });
            }
        }
        $('table tbody').on('click', '.btn-view', function () {
            $.ajax({
                type: "GET",
                url: root + "/GetUserDetail/" + $(this).closest('tr').find('th').eq(0).text(),
                contentType: "application/json; charset=utf-8;",
                dataType: "json",
                success: function (data) {
                    if (data != undefined) {
                        $("#viewhouse").val(data.houseText);
                        $("#viewusername").val(data.username);
                        $("#viewfirstname").val(data.firstname);
                        $("#viewlastname").val(data.lastname);
                        $("#viewnickname").val(data.nickname);
                        $("#viewphone1").val(data.phone1);
                        $("#viewphone2").val(data.phone2);
                        $("#viewuseraccess").val(data.accessText);
                        if (data.status == 1)
                            $("#viewstatus1").prop('checked', true);
                        else if (data.status == 2)
                            $("#viewstatus2").prop('checked', true);
                        $("#viewcustomerline").val(data.customerLineText);
                    }
                },
                error: function (e) { console.log(e) }
            });
        });
        $('table tbody').on('click', '.btn-edit', function () {
            $("#editid").val($(this).closest('tr').find('th').eq(0).text());
            $.ajax({
                type: "GET",
                url: root + "/GetUserDetail/" + $(this).closest('tr').find('th').eq(0).text(),
                contentType: "application/json; charset=utf-8;",
                dataType: "json",
                success: function (data) {
                    if (data != undefined) {
                        $("#username").val(data.username);
                        $("#firstname").val(data.firstname);
                        $("#lastname").val(data.lastname);
                        $("#nickname").val(data.nickname);
                        $("#password").val(data.password);
                        $("#confirmpassword").val(data.password);
                        $("#phone1").val(data.phone1);
                        $("#phone2").val(data.phone2);
                        $("#useraccess").val(data.userAccess);
                        if (data.status == 1)
                            $("#status1").prop('checked', true);
                        else if (data.status == 2)
                            $("#status2").prop('checked', true);
                        $("#house").val(data.houseId);
                        $('<option value="0">-</option>').appendTo($('#customerline').empty());
                        $.ajax({
                            type: "GET",
                            url: root + "/GetCustomerLineAll/" + $("#house").val(),
                            contentType: "application/json; charset=utf-8;",
                            dataType: "json",
                            success: function (data1) {
                                if (data1 != undefined) {
                                    for (var it of data1) {
                                        $('#customerline').append('<option value="' + it['id'] + '">' + it['customerLineName'] + '</option>');
                                    }
                                    $("#customerline").val(data.customerLineId);
                                }
                            },
                            error: function (e) { console.log(e) }
                        });
                    }
                },
                error: function (e) { console.log(e) }
            });
        });
        $('table tbody').on('click', '.btn-delete', function () {
            $("#deleteid").val($(this).closest('tr').find('th').eq(0).text());
            $("#deletename").html($(this).closest('tr').find('td').eq(0).text());
        });
        $("#delete").click(function () {
            let req = new XMLHttpRequest();
            req.open("GET", '/DeleteUser/' + $("#deleteid").val());
            req.send();
            req.onload = function () {
                if (req.readyState != 4 || req.status != 200) {
                    $("#msg").text(req.responseText)
                } else {
                    alert(req.responseText);
                    location.reload();
                }
            }
        });
    });
</script>