@using DailyLoan.Library.Status
<div class="container">
    <div class="card-body bg-light p-3 rounded ">
        <div class="input-group mb-3 input-group-sm">
            <input type="text" class="form-control" id="searchidcard" placeholder="เลขบัตรประชาชน">
            <input type="text" class="form-control" id="searchaddress" placeholder="สถานที่">

        </div>
        <div class="input-group mb-3 input-group-sm">
            <input type="text" class="form-control" id="searchfname" placeholder="ชื่อ">
            <input type="text" class="form-control" id="searchlname" placeholder="นามสกุล">
        </div>
        <div class="input-group mb-3 input-group-sm justify-content-center">
            <button type="button" onclick="search();" class="btn btn-info btn-sm">
                <i class="fa fa-search"></i>
                ค้นหา
            </button>
        </div>
        <!-- The Modal viewhistory -->
        <div class="modal" id="viewhistory">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header" style="background-color:#ff9800;color:#000;">
                        <h4 class="modal-title">ประวัติ</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <!-- Modal body -->
                    <div class="modal-body">
                        <form>
                            <div class="card-body bg-light p-3 rounded ">
                                <div class="accordion" id="accordionPanelsStayOpenExample">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                                                รายละเอียด
                                            </button>
                                        </h2>
                                        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
                                            <div class="accordion-body">
                                                <form>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">วันที่เริ่มสัญญา</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewcondate" placeholder="วันที่เริ่มสัญญา" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">ยอดกู้เงิน</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewconamount" placeholder="ยอดกู้เงิน" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">ยอดที่จ่ายแล้ว</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewtotalpay" placeholder="ยอดที่จ่าย" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">สถานะสัญญา</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewconstatus" placeholder="สถานะสัญญา" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col pb-3">
                                                                    <table class="table table-hover" style="text-align: center; vertical-align: middle;">
                                                                        <thead>
                                                                            <tr>
                                                                                <th scope="col">#</th>
                                                                                <th scope="col">วันที่</th>
                                                                                <th scope="col">ยอดที่ต้องเก็บ</th>
                                                                                <th scope="col">ยอดที่เก็บได้</th>
                                                                                <th scope="col">หมายเหตุ</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="viewhistorytable">
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="panelsStayOpen-headingTwo_1">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo_1" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo_1">
                                                ข้อมูลคนกู้
                                            </button>
                                        </h2>
                                        <div id="panelsStayOpen-collapseTwo_1" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo_1">
                                            <div class="accordion-body">
                                                <form>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">ชื่อ</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewfirstname" placeholder="ชื่อ" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">นามสกุล</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewlastname" placeholder="นามสกุล" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">ชื่อเล่น</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewnickname" placeholder="ชื่อเล่น" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">เลขบัตรประจำตัวประชาชน</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewidcard" placeholder="เลขบัตรประจำตัวประชาชน" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">เบอร์โทร 1</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewphone1" placeholder="เบอร์โทร 1" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="inputEmail4">เบอร์โทร 2</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewphone2" placeholder="เบอร์โทร 2" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
                                                    {
                                                        <div class="form-row">
                                                            <div class="container-fluid">
                                                                <div class="row">
                                                                    <div class="col-md-6 pb-3">
                                                                        <label for="viewhouse">บ้าน</label>
                                                                        <input type="text" class="form-control form-control-sm" id="viewhouse" placeholder="" readonly>
                                                                    </div>
                                                                    <div class="col-md-6 pb-3">
                                                                        <label for="viewcustomerline">สาย</label>
                                                                        <input type="text" class="form-control form-control-sm" id="viewcustomerline" placeholder="" readonly>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Admin.ToString())
                                                    {
                                                        <div class="form-row">
                                                            <div class="container-fluid">
                                                                <div class="row">
                                                                    <div class="col-md-6 pb-3">
                                                                        <label for="viewcustomerline">สาย</label>
                                                                        <input type="text" class="form-control form-control-sm" id="viewcustomerline" placeholder="" readonly>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewaddress">สถานที่</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewaddress" placeholder="สถานที่" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewshortaddress">สถานที่ย่อ</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewshortaddress" placeholder="สถานที่" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <input type="radio" id="viewstatus1" name="viewstatus" value="1" disabled>
                                                                    <label for="viewstatus1">ดี</label>
                                                                    <input type="radio" id="viewstatus2" name="viewstatus" value="2" disabled>
                                                                    <label for="viewstatus2">แย่</label>
                                                                    <input type="radio" id="viewstatus3" name="viewstatus" value="3" disabled>
                                                                    <label for="viewstatus3">เสีย</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div id="imgcview" class="col pb-3">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                                                ข้อมูลคนค้ำ
                                            </button>
                                        </h2>
                                        <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
                                            <div class="accordion-body">
                                                <form>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewfirstname">ชื่อ</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewgfirstname" placeholder="ชื่อ" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewlastname">นามสกุล</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewglastname" placeholder="นามสกุล" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewnickname">ชื่อเล่น</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewgnickname" placeholder="ชื่อเล่น" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewidcard">เลขบัตรประจำตัวประชาชน</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewgidcard" placeholder="เลขบัตรประจำตัวประชาชน" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewphone1">เบอร์โทร 1</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewgphone1" placeholder="เบอร์โทร 1" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewphone2">เบอร์โทร 2</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewgphone2" placeholder="เบอร์โทร 2" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
                                                    {
                                                        <div class="form-row">
                                                            <div class="container-fluid">
                                                                <div class="row">
                                                                    <div class="col-md-6 pb-3">
                                                                        <label for="viewhouse">บ้าน</label>
                                                                        <input type="text" class="form-control form-control-sm" id="viewghouse" placeholder="" readonly>
                                                                    </div>
                                                                    <div class="col-md-6 pb-3">
                                                                        <label for="viewcustomerline">สาย</label>
                                                                        <input type="text" class="form-control form-control-sm" id="viewgcustomerline" placeholder="" readonly>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Admin.ToString())
                                                    {
                                                        <div class="form-row">
                                                            <div class="container-fluid">
                                                                <div class="row">
                                                                    <div class="col-md-6 pb-3">
                                                                        <label for="viewcustomerline">สาย</label>
                                                                        <input type="text" class="form-control form-control-sm" id="viewgcustomerline" placeholder="" readonly>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewaddress">สถานที่</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewgaddress" placeholder="สถานที่" readonly>
                                                                </div>
                                                                <div class="col-md-6 pb-3">
                                                                    <label for="viewshortaddress">สถานที่ย่อ</label>
                                                                    <input type="text" class="form-control form-control-sm" id="viewgshortaddress" placeholder="สถานที่" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div class="col-md-6 pb-3">
                                                                    <input type="radio" id="viewgstatus1" name="viewgstatus" value="1" disabled>
                                                                    <label for="viewgstatus1">ดี</label>
                                                                    <input type="radio" id="viewgstatus2" name="viewgstatus" value="2" disabled>
                                                                    <label for="viewgstatus2">แย่</label>
                                                                    <input type="radio" id="viewgstatus3" name="viewgstatus" value="3" disabled>
                                                                    <label for="viewgstatus3">เสีย</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="container-fluid">
                                                            <div class="row">
                                                                <div id="imggview" class="col pb-3">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--end -->
    <!-- The Modal closecontract -->
    <div class="modal" id="closecontract">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header" style="background-color:#ff9800;color:#000;">
                    <h4 class="modal-title">ปิดสัญญา</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <form>
                        <div class="form-row">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col pb-3">
                                        <table class="table table-hover" style="text-align: center; vertical-align: middle;">
                                            <thead>
                                                <tr>
                                                    <th scope="col">#</th>
                                                    <th scope="col">ยอดเงินกู้</th>
                                                    <th scope="col">ยอดเงินที่จ่าย</th>
                                                    <th scope="col">ยอดเงินที่เหลือ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">1</th>
                                                    <td>1000</td>
                                                    <td>800</td>
                                                    <td>xx</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">ขออนุมัติ</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
                </div>

            </div>
        </div>
    </div>
</div>
<!--end -->
<!-- The Modal closecontract_1 -->
<div class="modal" id="closecontract_1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header" style="background-color:#ff9800;color:#000;">
                <h4 class="modal-title">ตัดยอดปกติ</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <form>
                    <div class="form-row">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col pb-3">
                                    <table class="table table-hover" style="text-align: center; vertical-align: middle;">
                                        <thead>
                                            <tr>
                                                <th scope="col">ยอดเงินกู้</th>
                                                <th scope="col">ยอดเงินกู้รวมดอก</th>
                                                <th scope="col">ยอดเงินที่จ่าย</th>
                                                <th scope="col">ยอดเงินที่เหลือ</th>
                                                <th scope="col">จำนวนตัด</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td id="cuttotalamount">0</td>
                                                <td id="cuttotalprofit">0</td>
                                                <td id="cuttotalpay">0</td>
                                                <td id="cutremain">0</td>
                                                <td id="cutcutcount">0</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="savecut()" data-bs-dismiss="modal">ขออนุมัติ</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
            </div>
        </div>
    </div>
</div>
<!--end -->
<!-- The Modal downcontract -->
<div class="modal" id="downcontract">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header" style="background-color:#ff9800;color:#000;">
                <h4 class="modal-title">ตัดลด</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <form>
                    <div class="form-row">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col pb-3">
                                    <table class="table table-hover" style="text-align: center; vertical-align: middle;">
                                        <thead>
                                            <tr>
                                                <th scope="col">ยอดเงินกู้</th>
                                                <th scope="col">ยอดเงินกู้รวมดอก</th>
                                                <th scope="col">ยอดเงินที่จ่าย</th>
                                                <th scope="col">ยอดเงินที่เหลือ</th>
                                                <th scope="col">จำนวนตัด</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td id="cutdectotalamount">0</td>
                                                <td id="cutdectotalprofit">0</td>
                                                <td id="cutdectotalpay">0</td>
                                                <td id="cutdecremain">0</td>
                                                <td id="cutdeccutcount">0</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col pb-3">
                                    <label for="cutdecamount">ยอดใหม่</label>
                                    <input type="text" class="form-control form-control-sm" id="cutdecamount" placeholder="ยอดใหม่">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="savecutdec()" data-bs-dismiss="modal">ขออนุมัติ</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
            </div>

        </div>
    </div>
</div>
<!--end -->
<!-- The Modal upcontract -->
<div class="modal" id="upcontract">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header" style="background-color:#ff9800;color:#000;">
                <h4 class="modal-title">ตัดเพิ่ม</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <form>
                    <div class="form-row">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col pb-3">
                                    <table class="table table-hover" style="text-align: center; vertical-align: middle;">
                                        <thead>
                                            <tr>
                                                <th scope="col">ยอดเงินกู้</th>
                                                <th scope="col">ยอดเงินกู้รวมดอก</th>
                                                <th scope="col">ยอดเงินที่จ่าย</th>
                                                <th scope="col">ยอดเงินที่เหลือ</th>
                                                <th scope="col">จำนวนตัด</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td id="cutinctotalamount">0</td>
                                                <td id="cutinctotalprofit">0</td>
                                                <td id="cutinctotalpay">0</td>
                                                <td id="cutincremain">0</td>
                                                <td id="cutinccutcount">0</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col pb-3">
                                    <label for="cutincamount">ยอดใหม่</label>
                                    <input type="text" class="form-control form-control-sm" id="cutincamount" placeholder="ยอดใหม่">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="savecutinc()" data-bs-dismiss="modal">ขออนุมัติ</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
            </div>

        </div>
    </div>
</div>
<!--end -->
<table id="table" class="table table-hover" style="text-align: center; vertical-align: middle;">
    <thead>
        <tr>
            <th style="display:none;" scope="col">#</th>
            <th scope="col">#</th>
            <th scope="col">ชื่อ</th>
            <th scope="col">นามสกุล</th>
            <th scope="col">สถานที่</th>
            <th scope="col">สถานะสัญญา</th>
            @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
            {
                <th scope="col">บ้าน</th>
            }
            @if (int.Parse(ViewBag.UserAccess) <= StatusUserAccess.UserAccess_Audit)
            {
                <th scope="col">สาย</th>
            }
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        @if (ViewBag.PageData.Count > 0)
        {
            var i = 1;
            foreach (var items in ViewBag.PageData)
            {
        <tr class='clickable-row'>
            <th style="display:none;" scope="row">@items.Id</th>
            <th>@i</th>
            <td>@items.Customer.Firstname</td>
            <td>@items.Customer.Lastname</td>
            <td>@items.Customer.Address</td>
            <td>@items.StatusText</td>
            @if (ViewBag.UserAccess == StatusUserAccess.UserAccess_Superadmin.ToString())
            {
                <td>@items.Customer.HouseText</td>
            }
            @if (int.Parse(ViewBag.UserAccess) <= StatusUserAccess.UserAccess_Audit)
            {
                <td>@items.Customer.CustomerLineText</td>
            }
            <td>
                <button type="button" class="btn btn-primary btn-sm btn-view" data-bs-toggle="modal" data-bs-target="#viewhistory">
                    <i class="fa fa-eye"></i>
                    ดูประวัติ
                </button>
                <!--
        <button type="button" class="btn btn-sm btn-closecon" data-bs-toggle="modal" data-bs-target="#closecontract" style="background-color: #FF551A;color:#fff;">
            ปิดสัญญา
        </button>
        -->
                @if (((items.canCut && ViewBag.UserAccess != StatusUserAccess.UserAccess_Audit.ToString()) || int.Parse(ViewBag.UserAccess) <= StatusUserAccess.UserAccess_Admin)
                    &&items.Status!=ContractStatus.StatusContract_WaitConfirm&&items.Status!=ContractStatus.StatusContract_NotApprove&&items.Status!=ContractStatus.StatusContract_Closed)
                {
                    <button type="button" class="btn btn-sm btn-cut" data-bs-toggle="modal" data-bs-target="#closecontract_1" style="background-color: #FF551A;color:#fff;">
                        ตัดยอดปกติ
                    </button>
                }
                @if (((items.canDecCut && ViewBag.UserAccess != StatusUserAccess.UserAccess_Audit.ToString()) || int.Parse(ViewBag.UserAccess) <= StatusUserAccess.UserAccess_Admin)
                    &&items.Status!=ContractStatus.StatusContract_WaitConfirm&&items.Status!=ContractStatus.StatusContract_NotApprove&&items.Status!=ContractStatus.StatusContract_Closed)
                {
                    <button type="button" class="btn btn-sm btn-dec" data-bs-toggle="modal" data-bs-target="#downcontract" style="background-color: #FF551A;color:#fff;">
                        ตัดลด
                    </button>
                }
                @if (((items.canIncCut && ViewBag.UserAccess != StatusUserAccess.UserAccess_Audit.ToString()) || int.Parse(ViewBag.UserAccess) <= StatusUserAccess.UserAccess_Admin)
                    &&items.Status!=ContractStatus.StatusContract_WaitConfirm&&items.Status!=ContractStatus.StatusContract_NotApprove&&items.Status!=ContractStatus.StatusContract_Closed)
                {
                    <button type="button" class="btn btn-sm btn-inc" data-bs-toggle="modal" data-bs-target="#upcontract" style="background-color: #FF551A;color:#fff;">
                        ตัดเพิ่ม
                    </button>
                }
            </td>
        </tr>
                i++;
            }
        }
    </tbody>
</table>
<input type="hidden" id="editid" />

<form id="searchform" style="display:none;" method="POST" action="/SearchHistory">
    <input type="text" id="ffirstname" name="Firstname">
    <input type="text" id="flastname" name="Lastname">
    <input type="text" id="faddress" name="Address">
    <input type="text" id="fidcard" name="Idcard">
</form>
<script type="text/javascript">
    var root = '@Url.Content("~/")';
    var useraccess = '@ViewBag.UserAccess';
    var superadmin = '@StatusUserAccess.UserAccess_Superadmin';
    var admin = '@StatusUserAccess.UserAccess_Admin';
    var audit = '@StatusUserAccess.UserAccess_Audit';
    var agent = '@StatusUserAccess.UserAccess_Agent';
    root = (root == '/' ? "" : root);
    function search() {
        $("#ffirstname").val($("#searchfname").val());
        $("#flastname").val($("#searchlname").val());
        $("#faddress").val($("#searchaddress").val());
        $("#fidcard").val($("#searchidcard").val());
        document.getElementById("searchform").submit();
    }
    function dateStr(dat) {
        var arr = dat.split('T');
        var da = arr[0].split('-');
        //var ti = arr[1].split('.');
        return da[2]+'/'+da[1]+'/'+da[0]
    }
    function savecut() {
        let req = new XMLHttpRequest();
        let formData = new FormData();
        formData.append("contractid", $("#editid").val());
        formData.append("type", @Request_Type.Cut);
        formData.append("amount", $("#cuttotalamount").text());
        req.open("POST", '/Cut');
        req.send(formData);
        req.onload = function () {
            if (req.readyState != 4 || req.status != 200) {
                alert("ไม่สามารถตัดได้");
            } else {
                alert(req.responseText);
                location.reload();
            }
        }
    }
    function savecutdec() {
        if ($("#cutdecamount").val() != null && $("#cutdecamount").val() != 0) {
            let req = new XMLHttpRequest();
            let formData = new FormData();
            formData.append("contractid", $("#editid").val());
            formData.append("type", @Request_Type.CutDecrease);
            formData.append("amount", $("#cutdecamount").val());
            req.open("POST", '/Cut');
            req.send(formData);
            req.onload = function () {
                if (req.readyState != 4 || req.status != 200) {
                    alert("ไม่สามารถตัดได้");
                } else {
                    alert(req.responseText);
                    location.reload();
                }
            }
        } else {
            alert('กรุณาระบุยอดเงิน');
        }
    }
    function savecutinc() {
        if ($("#cutincamount").val() != null && $("#cutincamount").val() != 0) {
            let req = new XMLHttpRequest();
            let formData = new FormData();
            formData.append("contractid", $("#editid").val());
            formData.append("type", @Request_Type.CutIncrease);
            formData.append("amount", $("#cutincamount").val());
            req.open("POST", '/Cut');
            req.send(formData);
            req.onload = function () {
                if (req.readyState != 4 || req.status != 200) {
                    alert("ไม่สามารถตัดได้");
                } else {
                    alert(req.responseText);
                    location.reload();
                }
            }
        } else {
            alert('กรุณาระบุยอดเงิน');
        }
    }
    $(document).ready(function () {
        /**/
        $('#table').DataTable({
            "ordering": false,
            "dom": 't<"bottom"p>',
            "info": false,
            "pageLength": 15,
            "bLengthChange": false,
            "language": {
                "paginate": {
                    "previous": "ก่อนหน้า",
                    "next": "ถัดไป",
                }
            },
            "initComplete": function () {

            }
        });
        /**/
        $('table tbody').on('click', '.btn-view', function () {
            $.ajax({
                type: "GET",
                url: root + "/GetHistoryDetail/" + $(this).closest('tr').find('th').eq(0).text(),
                contentType: "application/json; charset=utf-8;",
                dataType: "json",
                success: function (data) {
                    if (data != undefined) {
                        $("#viewhouse").val(data.customer.houseText);
                        $("#viewidcard").val(data.customer.idcard);
                        $("#viewfirstname").val(data.customer.firstname);
                        $("#viewlastname").val(data.customer.lastname);
                        $("#viewnickname").val(data.customer.nickname);
                        $("#viewphone1").val(data.customer.phone1);
                        $("#viewphone2").val(data.customer.phone2);
                        $("#viewaddress").val(data.customer.address);
                        if (data.customer.status == 1)
                            $("#viewstatus1").prop('checked', true);
                        else if (data.customer.status == 2)
                            $("#viewstatus2").prop('checked', true);
                        else if (data.customer.status == 3)
                            $("#viewstatus3").prop('checked', true);
                        $("#viewcustomerline").val(data.customer.customerLineText);
                        $("#viewshortaddress").val(data.customer.shortAddress);

                        $("#viewghouse").val(data.guaruntor.houseText);
                        $("#viewgidcard").val(data.guaruntor.idcard);
                        $("#viewgfirstname").val(data.guaruntor.firstname);
                        $("#viewglastname").val(data.guaruntor.lastname);
                        $("#viewgnickname").val(data.guaruntor.nickname);
                        $("#viewgphone1").val(data.guaruntor.phone1);
                        $("#viewgphone2").val(data.guaruntor.phone2);
                        $("#viewgaddress").val(data.guaruntor.address);
                        $("#viewgshortaddress").val(data.guaruntor.shortAddress);
                        if (data.guaruntor.status == 1)
                            $("#viewgstatus1").prop('checked', true);
                        else if (data.guaruntor.status == 2)
                            $("#viewgstatus2").prop('checked', true);
                        else if (data.guaruntor.status == 3)
                            $("#viewgstatus3").prop('checked', true);
                        $("#viewgcustomerline").val(data.guaruntor.customerLineText);

                        $("#viewconstatus").val(data.statusText);
                        $("#viewcondate").val(dateStr(data.createDate));
                        $("#viewconamount").val(data.totalAmount);
                        $("#viewtotalpay").val(data.totalPay);

                        $('<label for="inputEmail4">รูปบัตรประชาชน</label><br />').appendTo($('#imgcview').empty());
                        $('<label for="inputEmail4">รูปบัตรประชาชน</label><br />').appendTo($('#imggview').empty());
                        if (data.customer.images != null) {
                            for (var i in data.customer.images) {
                                $('#imgcview').append('<img src="/upload/' + data.customer.images[i] + '" style="width:100px;margin-left:20px;">');
                            }
                        }
                        if (data.guaruntor.images != null) {
                            for (var i in data.guaruntor.images) {
                                $('#imggview').append('<img src="/upload/' + data.guaruntor.images[i] + '" style="width:100px;margin-left:20px;">');
                            }
                        }
                        if (data.history != null) {
                            $('#viewhistorytable').empty();
                            for (var i in data.history) {
                                $('#viewhistorytable').append('<tr><th scope="row">' + (parseInt(i) + 1) + '</th><td>' + dateStr(data.history[i].createDate) + '</td><td>' + data.customer.installment + '</td><td>' + data.history[i].amount + '</td><td>' + data.history[i].remark + '</td></tr>');
                            }
                        }
                    }
                },
                error: function (e) { console.log(e) }
            });
        });
        $('table tbody').on('click', '.btn-inc', function () {
            $("#editid").val($(this).closest('tr').find('th').eq(0).text());
            $.ajax({
                type: "GET",
                url: root + "/GetCutDetail/" + $(this).closest('tr').find('th').eq(0).text(),
                contentType: "application/json; charset=utf-8;",
                dataType: "json",
                success: function (data) {
                    if (data != undefined) {
                        $("#cutinctotalamount").text(data.totalamount);
                        $("#cutinctotalprofit").text(data.totalprofit);
                        $("#cutinctotalpay").text(data.totalpay + '/' + data.payday + 'วัน '+ data.paypercen);
                        $("#cutincremain").text(data.remain);
                        $("#cutinccutcount").text(data.cutcount);
                    }
                },
                error: function (e) { console.log(e) }
            });
        });
        $('table tbody').on('click', '.btn-dec', function () {
            $("#editid").val($(this).closest('tr').find('th').eq(0).text());
            $.ajax({
                type: "GET",
                url: root + "/GetCutDetail/" + $(this).closest('tr').find('th').eq(0).text(),
                contentType: "application/json; charset=utf-8;",
                dataType: "json",
                success: function (data) {
                    if (data != undefined) {
                        $("#cutdectotalamount").text(data.totalamount);
                        $("#cutdectotalprofit").text(data.totalprofit);
                        $("#cutdectotalpay").text(data.totalpay + '/' + data.payday + 'วัน ' + data.paypercen);
                        $("#cutderemain").text(data.remain);
                        $("#cutdeccutcount").text(data.cutcount);
                    }
                },
                error: function (e) { console.log(e) }
            });
        });
        $('table tbody').on('click', '.btn-cut', function () {
            $("#editid").val($(this).closest('tr').find('th').eq(0).text());
            $.ajax({
                type: "GET",
                url: root + "/GetCutDetail/" + $(this).closest('tr').find('th').eq(0).text(),
                contentType: "application/json; charset=utf-8;",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    if (data != undefined) {
                        $("#cuttotalamount").text(data.totalamount);
                        $("#cuttotalprofit").text(data.totalprofit);
                        $("#cuttotalpay").text(data.totalpay + '/' + data.payday + 'วัน ' + data.paypercen);
                        $("#cutremain").text(data.remain);
                        $("#cutcutcount").text(data.cutcount);
                    }
                },
                error: function (e) { console.log(e) }
            });
        });
    });
</script>